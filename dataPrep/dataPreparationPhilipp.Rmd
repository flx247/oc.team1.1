---
title: "dataPreparationPhilipp"
author: "Philipp Meisinger"
date: "`r Sys.Date()`"
output: html_document
---


# Loading in the Tidyverse
```{r}
library(tidyverse)
```

# Storing Data sets as data frames
```{r}
revenue <- read.csv('../data/original/umsatzdaten_gekuerzt.csv')
kiwo <- read.csv('../data/original/kiwo.csv')
ferien <- read.csv('../data/original/schulferien_sh.csv')
weather <- read.csv('../data/original/weather.csv')
```

# Joining the kiwo data with the revenue data
## Left join to keep all values of revenue
## Replacing all instances of Kiwo = NA with Kiwo = 0
## Reformating Column KielerWoche to boolean values
```{r}
df <- full_join(revenue, kiwo, by = "Datum") %>%
  replace_na(list(KielerWoche = 0)) %>%
  mutate(KielerWoche = ifelse(KielerWoche == 1, TRUE, FALSE))
  
df
```


# Joining the weather data with the df containing revenue and kiwo
```{r}
df <- full_join(df, weather, by = "Datum")

df
```

# Cleaning up the revenue data to convert Datum column to correct data type (i.e. char -> date)
```{r}
df$Datum <- as.Date(df$Datum, format = "%Y-%m-%d")

df

```
# Converting the  "Warengruppe" to char, as the algorithm might interpret the numeric values as ordered, while they are categorial.
```{r}
df <- df %>%
  mutate(Warengruppe = ifelse(Warengruppe == 1, "Brot", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 2, "BrÃ¶tchen", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 3, "Croissant", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 4, "Konditorei", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 5, "Kuchen", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 6, "Saisonbrot", Warengruppe))
```

# Adding weekday column to data set
```{r}
df$weekday <- weekdays(df$Datum)
df
```

# Adding holiday column to data set
```{r}
df <- full_join(df, ferien, by = "Datum") %>%
  replace_na(list(SchulferienSH = 0)) %>%
  mutate(SchulferienSH = ifelse(SchulferienSH == True, TRUE, FALSE))
  
df
```

# This helps us figure out if we have NA values in the dataset
```{r}
any(is.na(df))
write.csv(df, "data/data_combined.csv", row.names = FALSE)
```


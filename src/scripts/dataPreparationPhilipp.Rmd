---
title: "dataPreparationPhilipp"
author: "Philipp Meisinger, Olav Cornelius, Alexander Ruoff, Felix Wehkamp"
date: "`r Sys.Date()`"
output: html_document
---

## Datenaufbereitung und Visualisierung
We have to install the Python environment in order to run the following pieces of code.
```{r include=FALSE}
# Create list with required libraries
libraries <- c("dplyr", "readr", "reticulate", "ggplot2", "Metrics", "tidyverse", "glmnet", "e1071", "lubridate")


# Loop through each library and check if it's installed, if not, install it and then load it to include in this project
for (lib in libraries)
{
  if (!require(lib, character.only = TRUE))
  {
    install.packages(lib)
    library(lib, character.only = TRUE)
  }
}

```

### Data Import

```{r include=FALSE}
# Storing Data sets as data frames

revenue <- read.csv('../data/umsatzdaten_gekuerzt.csv')
kiwo <- read.csv('../data/kiwo.csv')
ferien <- read.csv('../data/schulferienSH.csv')
weather <- read.csv('../data/weather.csv')

```

### Joining the kiwo data with the revenue data

Replacing all instances of Kiwo = NA with Kiwo = 0 Reformating Column KielerWoche to boolean values

```{r include=FALSE}
df <- left_join(revenue, kiwo, by = "Datum") %>%
  replace_na(list(KielerWoche = 0)) %>%
  mutate(KielerWoche = ifelse(KielerWoche == 1, TRUE, FALSE))

```

### Joining the weather data with the df containing revenue and kiwo

```{r include=FALSE}
df <- left_join(df, weather, by = "Datum")

```

### Cleaning up the revenue data to convert Datum column to correct data type (i.e. char -\> date)

```{r include=FALSE}
df$Datum <- as.Date(df$Datum, format = "%Y-%m-%d")
```

### Converting the "Warengruppe" to char, as the algorithm might interpret the numeric values as ordered, while they are categorial.

```{r include=FALSE}
df <- df %>%
  mutate(Warengruppe = ifelse(Warengruppe == 1, "Brot", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 2, "BrÃ¶tchen", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 3, "Croissant", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 4, "Konditorei", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 5, "Kuchen", Warengruppe)) %>%
  mutate(Warengruppe = ifelse(Warengruppe == 6, "Saisonbrot", Warengruppe))
```

### Adding weekday column to data set

```{r include=FALSE}
df$Wochentag <- weekdays(df$Datum)
```

### Adding holiday column to data set

```{r include=FALSE}
ferien$Datum <- as.Date(ferien$Datum, format = "%Y-%m-%d")

df <- left_join(df, ferien, by = "Datum") %>%
  replace_na(list(FerienSH = 0)) %>%
  mutate(FerienSH = ifelse(FerienSH == 1, TRUE, FALSE))
```

### Adding Month variable
```{r}
df$Monat <- month(df$Datum)
```


### This helps us figure out if we have NA values in the dataset

```{r include=FALSE}
any(is.na(df))

any(is.na(df$Datum))
any(is.na(df$Warengruppe))
any(is.na(df$Umsatz))
any(is.na(df$KielerWoche))
any(is.na(df$Wochentag))
any(is.na(df$FerienSH))

any(is.na(df$Bewoelkung))
any(is.na(df$Temperatur))
any(is.na(df$Windgeschwindigkeit))
any(is.na(df$Wettercode))

```

### Data Imputation
```{r}

```



### Deleting all rows that contain even one NA value (This section will be replaced with data imputation later on.)

```{r include=FALSE}
# Check for complete cases
complete_rows <- complete.cases(df)

# Subset the data frame to keep only complete rows
clean_df <- df[complete_rows, ]

write_csv(clean_df, "../data/data.csv")

#From here on out I'll work with the clean_df data set. Once the imputation step is implemented, the following code can be used for both.
```